<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>BTC 账户体系存在的问题 | 区块链学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="哔哩哔哩 —— 肖臻公开课《区块链技术与应用》学习笔记">
    
    <link rel="preload" href="/coin-notes/assets/css/0.styles.1213c4b0.css" as="style"><link rel="preload" href="/coin-notes/assets/js/app.3ac0d405.js" as="script"><link rel="preload" href="/coin-notes/assets/js/2.05c3ac16.js" as="script"><link rel="preload" href="/coin-notes/assets/js/26.770c76ac.js" as="script"><link rel="prefetch" href="/coin-notes/assets/js/10.c50c7f3a.js"><link rel="prefetch" href="/coin-notes/assets/js/11.a7331f9e.js"><link rel="prefetch" href="/coin-notes/assets/js/12.b18c528d.js"><link rel="prefetch" href="/coin-notes/assets/js/13.1a5b2c4b.js"><link rel="prefetch" href="/coin-notes/assets/js/14.279786df.js"><link rel="prefetch" href="/coin-notes/assets/js/15.ede2ab4d.js"><link rel="prefetch" href="/coin-notes/assets/js/16.e310b41c.js"><link rel="prefetch" href="/coin-notes/assets/js/17.ec2950cf.js"><link rel="prefetch" href="/coin-notes/assets/js/18.c0fe37fb.js"><link rel="prefetch" href="/coin-notes/assets/js/19.4ad411cf.js"><link rel="prefetch" href="/coin-notes/assets/js/20.f841a794.js"><link rel="prefetch" href="/coin-notes/assets/js/21.b8a35657.js"><link rel="prefetch" href="/coin-notes/assets/js/22.01c56d62.js"><link rel="prefetch" href="/coin-notes/assets/js/23.0b0d06bb.js"><link rel="prefetch" href="/coin-notes/assets/js/24.32856ccc.js"><link rel="prefetch" href="/coin-notes/assets/js/25.a0734032.js"><link rel="prefetch" href="/coin-notes/assets/js/27.0533c371.js"><link rel="prefetch" href="/coin-notes/assets/js/28.f21df515.js"><link rel="prefetch" href="/coin-notes/assets/js/29.f93df642.js"><link rel="prefetch" href="/coin-notes/assets/js/3.67cf15e5.js"><link rel="prefetch" href="/coin-notes/assets/js/30.c8a5a37b.js"><link rel="prefetch" href="/coin-notes/assets/js/31.b1b80530.js"><link rel="prefetch" href="/coin-notes/assets/js/32.476c0b7b.js"><link rel="prefetch" href="/coin-notes/assets/js/33.a5c1f03d.js"><link rel="prefetch" href="/coin-notes/assets/js/34.45b30bbc.js"><link rel="prefetch" href="/coin-notes/assets/js/4.cb043221.js"><link rel="prefetch" href="/coin-notes/assets/js/5.865faee2.js"><link rel="prefetch" href="/coin-notes/assets/js/6.e5025f99.js"><link rel="prefetch" href="/coin-notes/assets/js/7.dab81bed.js"><link rel="prefetch" href="/coin-notes/assets/js/8.4c09a35d.js"><link rel="prefetch" href="/coin-notes/assets/js/9.bc389121.js">
    <link rel="stylesheet" href="/coin-notes/assets/css/0.styles.1213c4b0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/coin-notes/" class="home-link router-link-active"><!----> <span class="site-name">区块链学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/coin-notes/overview01.html" class="nav-link">
  👉 学习笔记
</a></div><div class="nav-item"><a href="https://github.com/ok-james/coin-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/coin-notes/overview01.html" class="nav-link">
  👉 学习笔记
</a></div><div class="nav-item"><a href="https://github.com/ok-james/coin-notes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/coin-notes/overview01.html" class="sidebar-link">01 - 课程简介</a></li><li><section class="sidebar-group collapsable depth-0"><a href="/coin-notes/btc/btc02" class="sidebar-heading clickable"><span>BTC</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><a href="/coin-notes/eth/eth14" class="sidebar-heading clickable open"><span>ETH</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/coin-notes/eth/eth14.html" class="sidebar-link">14 - ETH-以太坊概述</a></li><li><a href="/coin-notes/eth/eth15.html" aria-current="page" class="active sidebar-link">15 - ETH-账户</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/coin-notes/eth/eth15.html#btc-账户体系存在的问题" class="sidebar-link">BTC 账户体系存在的问题</a></li><li class="sidebar-sub-header"><a href="/coin-notes/eth/eth15.html#eth-的账户体系" class="sidebar-link">ETH 的账户体系</a></li></ul></li><li><a href="/coin-notes/eth/eth16.html" class="sidebar-link">16 - ETH-状态树</a></li><li><a href="/coin-notes/eth/eth17.html" class="sidebar-link">17 - ETH-交易树和收据树</a></li><li><a href="/coin-notes/eth/eth18.html" class="sidebar-link">18 - ETH-GHOST</a></li><li><a href="/coin-notes/eth/eth19.html" class="sidebar-link">19 - ETH-挖矿算法 ethash</a></li><li><a href="/coin-notes/eth/eth20.html" class="sidebar-link">20 - ETH-难度调整</a></li><li><a href="/coin-notes/eth/eth21.html" class="sidebar-link">21 - ETH-权益证明</a></li><li><a href="/coin-notes/eth/eth22.html" class="sidebar-link">22 - ETH-智能合约</a></li><li><a href="/coin-notes/eth/eth23.html" class="sidebar-link">23 - ETH-TheDAO</a></li><li><a href="/coin-notes/eth/eth24.html" class="sidebar-link">24 - ETH-反思</a></li><li><a href="/coin-notes/eth/eth25.html" class="sidebar-link">25 - ETH-美链</a></li></ul></section></li><li><a href="/coin-notes/summary26.html" class="sidebar-link">26 - 总结</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="btc-账户体系存在的问题"><a href="#btc-账户体系存在的问题" class="header-anchor">#</a> BTC 账户体系存在的问题</h2> <ol><li>UTXO 与日常的支付体系相比，使用体验有很大不同。在日常生活中，我们的银行账户收到一笔钱以后，在支付的时候，不需要关心花出去的钱的来源。而对于 UTXO 来说，必须知道之前交易的输出（Output）才可以；</li> <li>对于 UTXO 来说，即使转账的金额小于一个交易的输出，也需要以该输出作为输入，并将剩余的 BTC 以新的 UTXO 的形式存入原账户或者新创建的账户。</li></ol> <h2 id="eth-的账户体系"><a href="#eth-的账户体系" class="header-anchor">#</a> ETH 的账户体系</h2> <p>ETH 的账户系统与银行的账户体系是类似的，是基于账户的模型，系统需要显式地记录每个账户上有多少个 ETH ，而在支付的时候，也不需要指定币的来源。</p> <h3 id="双花-double-spending-攻击"><a href="#双花-double-spending-攻击" class="header-anchor">#</a> 双花（double spending）攻击</h3> <p>这样的账户系统可以天然的防止 <strong>双花</strong> 攻击，因为一个人花了一次钱以后，他如果选择再花一次，那就再从账户余额中扣除即可，如果余额不足，则交易会直接失败。 <strong>双花</strong> 攻击是花钱的人不诚实，希望多次支付。</p> <h4 id="比特币是如何防止双花攻击的"><a href="#比特币是如何防止双花攻击的" class="header-anchor">#</a> 比特币是如何防止双花攻击的？</h4> <p>比特币防止双花攻击的方式与防止重放攻击的方式是相同的，详情可查看下面《比特币是如何防止重放攻击的？》。这里多说一句，比特币防止双花攻击时，不需要检验账户的余额。</p> <p>基于余额的检查与基于 output 的检查有什么区别呢？</p> <p>举个例子，假设一个用户 A 的一个账户下有 7 个 BTC，只不过存在于两个 output 中，分别是 3 个和 4 个。现在用户先将 5 个 BTC 转给 B ，然后 <em>马上</em> 又转 1 个 BTC 给 C 。</p> <p>如果是基于余额的检查，那么两个交易应该都能成功，因为用户 A 的余额是足以支付这两笔交易的。</p> <p>但是，如果是基于 output 的检查，这两个交易只能有一个成功。因为第一笔交易需要使用到两个 output ，而每个 output 只能花一次，所以，再 <em>马上</em> 发起第二个请求时，花费的肯定是这两个 output 中的一个，但是这两个 output 已经花过了，所以第二个交易是一个双花，不会成功。</p> <p>当然，具体哪个交易会成功，是不一定的。但是，只会有一个成功。</p> <h4 id="以太坊是如何防止双花攻击的"><a href="#以太坊是如何防止双花攻击的" class="header-anchor">#</a> 以太坊是如何防止双花攻击的？</h4> <p>正如上面提到的，对于 ETH 来说，是直接查询账户的余额，余额足够支付，则交易成功，否则，交易失败。</p> <h3 id="重放-replay-attack-攻击"><a href="#重放-replay-attack-攻击" class="header-anchor">#</a> 重放（replay attack）攻击</h3> <p>这样的账户体系虽然可以防止 <strong>双花</strong> 攻击，但却更容易遭受 <strong>重放</strong> 攻击。 <strong>重放</strong> 攻击是指，A 向 B 发起一个支付交易并成功后， B 将该交易在区块链上重复发布，从而形成多次的转账交易。 <strong>重放</strong> 攻击是收钱的人不诚实，希望多次收款。</p> <h4 id="比特币是如何防止重放攻击的"><a href="#比特币是如何防止重放攻击的" class="header-anchor">#</a> 比特币是如何防止重放攻击的？</h4> <p>我觉得视频中，老师对于比特币防止 <strong>重放</strong> 攻击的解释不太准确。我的理解是，比特币可以防止重放攻击是因为一个 output 只能被花费一次，也就是说，要花费一个 output ，就必须全部花费出去，如果有剩余，则以找零的形式存储在另一个 output 中。</p> <p>在一个交易的 inputs 中会指定其所对应的前一个交易的 output ，然后会在当前交易中生成一个或多个新的 output ，如果对这个交易进行重放，由于前一次交易的 output 已经被花费过一次，所以重放无效。</p> <h4 id="以太坊中如何防止重放攻击"><a href="#以太坊中如何防止重放攻击" class="header-anchor">#</a> 以太坊中如何防止重放攻击？</h4> <p>在交易中加一个交易次数的字段 <code>nonce</code> ，这个交易次数是当前账户一共发起的交易次数的计数。</p> <p>注意将这个 <code>nonce</code> 与区块链的 block header 中的 <code>nonce</code> 区分开来，这个 <code>nonce</code> 是每个交易都会存在的字段。</p> <h3 id="账户类型"><a href="#账户类型" class="header-anchor">#</a> 账户类型</h3> <h4 id="外部账户-externally-owned-account"><a href="#外部账户-externally-owned-account" class="header-anchor">#</a> 外部账户 externally owned account</h4> <p><code>外部账户</code> 是由人控制的，通过公私钥对创建的账户。</p> <p><code>外部账户</code> 具有的字段：</p> <ul><li>余额 balance</li> <li>交易次数 nonce</li></ul> <h4 id="合约账户-smart-contract-account"><a href="#合约账户-smart-contract-account" class="header-anchor">#</a> 合约账户 smart contract account</h4> <p><code>合约账户</code> 不是通过公私钥对创建的， <code>合约账户</code> 是通过 <code>外部账户</code> 创建智能合约时生成的。 <code>合约账户</code> 不能主动发起一个交易，必须通过 <code>外部账户</code> 进行调用。</p> <p><code>合约账户</code> 除了拥有上面提到的 <code>外部账户</code> 所拥有的字段之外，还具有额外的如下字段：</p> <ul><li>代码 code</li> <li>存储 storage</li></ul> <p>创建智能合约时，会返回一个地址，通过这个地址就可以调用智能合约。</p> <h4 id="eth-设计新的账户体系的原因"><a href="#eth-设计新的账户体系的原因" class="header-anchor">#</a> ETH 设计新的账户体系的原因</h4> <p>以太坊账户体系的好处是，账户比较稳定，不像 BTC 那样，生成一个 UTXO 以后，就会生成新的地址。智能合约需要稳定的账户体系，否则智能合约的执行可能就会有问题了。</p> <p>个人理解：我不太同意老师的观点，BTC 在生成 UTXO 时，找零输出的地址不一定需要新生成，这样做，主要是为了安全性考虑，因为在发生交易时，会暴露公钥，为了防止通过公钥反推出私钥，才重新生成一个新的公私钥以及地址。</p> <p>而对于以太坊来说，如果因为用户的账户有问题而导致智能合约的执行有问题的话，那也需要智能合约考虑到这种异常情况，并由用户承担相应的后果。</p> <p>所以，我不太认同老师的观点。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/coin-notes/eth/eth14.html" class="prev">
        14 - ETH-以太坊概述
      </a></span> <span class="next"><a href="/coin-notes/eth/eth16.html">
        16 - ETH-状态树
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/coin-notes/assets/js/app.3ac0d405.js" defer></script><script src="/coin-notes/assets/js/2.05c3ac16.js" defer></script><script src="/coin-notes/assets/js/26.770c76ac.js" defer></script>
  </body>
</html>
