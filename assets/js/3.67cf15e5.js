(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{428:function(t,s,a){t.exports=a.p+"assets/img/tx_api.6106d515.png"},429:function(t,s,a){t.exports=a.p+"assets/img/get_tx_raw.3583d5fc.png"},430:function(t,s,a){t.exports=a.p+"assets/img/decode_tx_raw.3aa87bd0.png"},431:function(t,s,a){t.exports=a.p+"assets/img/script_basic.ffe7e7f1.png"},432:function(t,s,a){t.exports=a.p+"assets/img/ins_one.4853faf7.png"},433:function(t,s,a){t.exports=a.p+"assets/img/ins_result_one.c39e7c20.png"},434:function(t,s,a){t.exports=a.p+"assets/img/ins_two.c30beda9.png"},435:function(t,s,a){t.exports=a.p+"assets/img/ins_three.b3160a96.png"},436:function(t,s,a){t.exports=a.p+"assets/img/mul_sig_old.d6fe69d4.png"},437:function(t,s,a){t.exports=a.p+"assets/img/mul_sig_new.3e54f69a.png"},438:function(t,s,a){t.exports=a.p+"assets/img/ins_four.78212ed8.png"},439:function(t,s,a){t.exports=a.p+"assets/img/proof_of_burn.915c56c5.png"},473:function(t,s,a){"use strict";a.r(s);var r=a(65),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"交易结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#交易结构"}},[t._v("#")]),t._v(" 交易结构")]),t._v(" "),r("h4",{attrs:{id:"meta-元数据结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#meta-元数据结构"}},[t._v("#")]),t._v(" meta 元数据结构")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("字段名")]),t._v(" "),r("th",[t._v("含义")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("txid")]),t._v(" "),r("td",[t._v("交易的id")])]),t._v(" "),r("tr",[r("td",[t._v("hash")]),t._v(" "),r("td",[t._v("交易的hash")])]),t._v(" "),r("tr",[r("td",[t._v("version")]),t._v(" "),r("td",[t._v("使用的比特币协议的版本号")])]),t._v(" "),r("tr",[r("td",[t._v("size")]),t._v(" "),r("td",[t._v("当前交易的大小")])]),t._v(" "),r("tr",[r("td",[t._v("locktime")]),t._v(" "),r("td",[t._v("用于指定交易的生效时间，0 表示立即生效，如果是非 0 值，那么这个交易需要过一段时间才能生效")])]),t._v(" "),r("tr",[r("td",[t._v("vin")]),t._v(" "),r("td",[t._v("交易的输入")])]),t._v(" "),r("tr",[r("td",[t._v("vout")]),t._v(" "),r("td",[t._v("交易的输出")])]),t._v(" "),r("tr",[r("td",[t._v("blockhash")]),t._v(" "),r("td",[t._v("这个交易所在区块的 hash")])]),t._v(" "),r("tr",[r("td",[t._v("confirmations")]),t._v(" "),r("td",[t._v("这个交易已经有多少个确认信息")])]),t._v(" "),r("tr",[r("td",[t._v("time")]),t._v(" "),r("td",[t._v("这个交易产生的时间")])]),t._v(" "),r("tr",[r("td",[t._v("blocktime")]),t._v(" "),r("td",[t._v("这个区块产生的时间")])])])]),t._v(" "),r("p",[t._v("个人声明：这些字段肯定不全是真实存储在链上的交易所拥有的字段，比如上面提到的 "),r("em",[t._v("confirmations")]),t._v(" 字段就不可能存储在真实的交易中。这些字段中，有些字段是直接存储在链上的，有些需要经过链下的二次加工得到。")]),t._v(" "),r("h4",{attrs:{id:"inputs-输入结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#inputs-输入结构"}},[t._v("#")]),t._v(" inputs 输入结构")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("字段名")]),t._v(" "),r("th",[t._v("含义")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("txid")]),t._v(" "),r("td",[t._v("币的来源交易的 hash 值")])]),t._v(" "),r("tr",[r("td",[t._v("vout")]),t._v(" "),r("td",[t._v("表示交易的第几个输出")])]),t._v(" "),r("tr",[r("td",[t._v("scriptSig")]),t._v(" "),r("td",[t._v("输入脚本")])])])]),t._v(" "),r("h4",{attrs:{id:"outputs-输出结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#outputs-输出结构"}},[t._v("#")]),t._v(" outputs 输出结构")]),t._v(" "),r("table",[r("thead",[r("tr",[r("th",[t._v("字段名")]),t._v(" "),r("th",[t._v("含义")])])]),t._v(" "),r("tbody",[r("tr",[r("td",[t._v("value")]),t._v(" "),r("td",[t._v("转账的输出金额")])]),t._v(" "),r("tr",[r("td",[t._v("n")]),t._v(" "),r("td",[t._v("序号，表示这是交易里的第几个输出")])]),t._v(" "),r("tr",[r("td",[t._v("scriptPubKey")]),t._v(" "),r("td",[t._v("输出脚本")])])])]),t._v(" "),r("h2",{attrs:{id:"获取链上的真实交易"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#获取链上的真实交易"}},[t._v("#")]),t._v(" 获取链上的真实交易")]),t._v(" "),r("p",[t._v("在区块链上，交易是通过 "),r("code",[t._v("hex")]),t._v(" 的形式保存的，要获取原始的 "),r("code",[t._v("hex")]),t._v(" ，有多种方式，很多区块链浏览器都有查询原始交易 "),r("code",[t._v("hex")]),t._v(" 的 API ，比如 "),r("a",{attrs:{href:"https://github.com/Blockstream/esplora/blob/master/API.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("blockStream API"),r("OutboundLink")],1),t._v(" ：")]),t._v(" "),r("p",[r("img",{attrs:{src:a(428),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("不过，最方便的方式还是通过 "),r("strong",[r("a",{attrs:{href:"https://bitcoindata.science/bitcoin-raw-transaction-hex.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Get Raw Transaction in Hex Format"),r("OutboundLink")],1)]),t._v(" 这个工具直接查询，只需输入交易 hash 即可：")]),t._v(" "),r("p",[r("img",{attrs:{src:a(429),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("得到 "),r("code",[t._v("hex")]),t._v(" 后，需要将其转换为 JSON 格式，可以通过 BLOCKCYPHER 的 "),r("a",{attrs:{href:"https://live.blockcypher.com/btc/decodetx/",target:"_blank",rel:"noopener noreferrer"}},[t._v("decodetx"),r("OutboundLink")],1),t._v(" 这个工具完成：")]),t._v(" "),r("p",[r("img",{attrs:{src:a(430),alt:"Merkle proof"}})]),t._v(" "),r("h4",{attrs:{id:"实例-921af728159e3019c18bbe0de9c70aa563ad27f3f562294d993a208d4fcfdd24-这个交易的原始-json"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实例-921af728159e3019c18bbe0de9c70aa563ad27f3f562294d993a208d4fcfdd24-这个交易的原始-json"}},[t._v("#")]),t._v(" 实例：921af728159e3019c18bbe0de9c70aa563ad27f3f562294d993a208d4fcfdd24 这个交易的原始 JSON")]),t._v(" "),r("div",{staticClass:"language-json extra-class"},[r("pre",{pre:!0,attrs:{class:"language-json"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"addresses"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1MaBFqBEfcQyXPv3fm5WAW9aQuJuKHaA3A"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"19z8LJkNXLrTv2QK5jgTncJCGUEEfpQvSr"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1LvGTpdyeVLcLCDK2m9f7Pbh7zwhs7NYhX"')]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"block_height"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"block_index"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("-1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"confirmations"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"double_spend"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("false")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"fees"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("29040")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"hash"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"921af728159e3019c18bbe0de9c70aa563ad27f3f562294d993a208d4fcfdd24"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"inputs"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"addresses"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1MaBFqBEfcQyXPv3fm5WAW9aQuJuKHaA3A"')]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"age"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("530654")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"output_index"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"output_value"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("76469684")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"prev_hash"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"c0cb92ca8e41070233bf965d808b0fc4bac144dab05690b17823fac3e184c57b"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"483045022100928496fb0d2a25e4e7c99b9c60d4d0d12fcf8974a0faffcb30119b0d385872a30220253d3d0c507e5e44e123bc28b795ab4a38bf3b205455403e77aa72d58d9e17110121022ef8d3a6dd8a7039e513acc8ecf9b094ed7e85439824a1d11920f85927cd0018"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script_type"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pay-to-pubkey-hash"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"sequence"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("4294967295")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"outputs"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"addresses"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"19z8LJkNXLrTv2QK5jgTncJCGUEEfpQvSr"')]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"76a914628ed6567c0b9056067309f07bbea2992ecad74388ac"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script_type"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pay-to-pubkey-hash"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("22684000")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"addresses"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n                "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"1LvGTpdyeVLcLCDK2m9f7Pbh7zwhs7NYhX"')]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"76a914da7d57dfd02c6f5a9c649e891b5ac199ad012cd288ac"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"script_type"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"pay-to-pubkey-hash"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"value"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("53756644")]),t._v("\n        "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"preference"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"high"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"received"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"2022-06-25T08:50:09.602679417Z"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"relayed_by"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"35.172.182.94"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"size"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("226")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"total"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("76440644")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"ver"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vin_sz"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vout_sz"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token property"}},[t._v('"vsize"')]),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("226")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),r("h2",{attrs:{id:"交易脚本入门"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#交易脚本入门"}},[t._v("#")]),t._v(" 交易脚本入门")]),t._v(" "),r("p",[t._v("交易脚本的作用就是验证当前交易的合法性，该脚本是一个特别简单的堆栈脚本，没有复杂的条件语句的判断，比如 if 、 for 等。")]),t._v(" "),r("p",[t._v("通过脚本验证交易时，是先取当前交易的输入脚本（input script），之后拼接上币的来源交易的输出脚本（output script），然后执行拼接后的脚本，如果最终的执行结果没有问题，验证成功，否则，验证失败，交易无效，拼接的示意图如下：")]),t._v(" "),r("p",[r("img",{attrs:{src:a(431),alt:"Merkle proof"}})]),t._v(" "),r("blockquote",[r("p",[t._v("这里再重点强调一下，输出脚本来自于币的来源（UTXO）所属的交易，而不是当前交易，一定要记住这一点。对于理解后面的内容，这一点非常重要。")])]),t._v(" "),r("h2",{attrs:{id:"输入输出脚本的几种形式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#输入输出脚本的几种形式"}},[t._v("#")]),t._v(" 输入输出脚本的几种形式")]),t._v(" "),r("h3",{attrs:{id:"p2pk-pay-to-public-key"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#p2pk-pay-to-public-key"}},[t._v("#")]),t._v(" P2PK（Pay to Public Key）")]),t._v(" "),r("h4",{attrs:{id:"算法表示形式"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#算法表示形式"}},[t._v("#")]),t._v(" 算法表示形式")]),t._v(" "),r("p",[r("strong",[t._v("input script:")])]),t._v(" "),r("p",[t._v("PUSHDATA(Sig)")]),t._v(" "),r("p",[r("strong",[t._v("output script:")])]),t._v(" "),r("p",[t._v("PUSHDATA(PubKey)")]),t._v(" "),r("p",[t._v("CHECKSI")]),t._v(" "),r("h4",{attrs:{id:"解释"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解释"}},[t._v("#")]),t._v(" 解释")]),t._v(" "),r("p",[t._v("算法表示形式中的 "),r("code",[t._v("PUSHDATA")]),t._v(" 是将数据放到栈顶。")]),t._v(" "),r("p",[r("code",[t._v("Sig")]),t._v(" 表示私钥的签名")]),t._v(" "),r("p",[r("code",[t._v("PubKey")]),t._v(" 表示上面提到的私钥所对应的公钥")]),t._v(" "),r("p",[r("code",[t._v("CHECKSI")]),t._v(" 方法弹出栈顶数据作为公钥，然后再弹出栈顶数据作为签名，最后用公钥来验证签名")]),t._v(" "),r("h4",{attrs:{id:"实例"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实例"}},[t._v("#")]),t._v(" 实例")]),t._v(" "),r("p",[r("img",{attrs:{src:a(432),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("input的交易哈希是ea44e97271691990157559d0bdd9959e02790c34db6c006d779e82fa5aee708e")]),t._v(" "),r("p",[t._v("另外，可以通过在 "),r("a",{attrs:{href:"https://blockstream.info",target:"_blank",rel:"noopener noreferrer"}},[t._v("Blockstream Explorer"),r("OutboundLink")],1),t._v(" 上更直观的查看结果，如下：")]),t._v(" "),r("p",[r("img",{attrs:{src:a(433),alt:"Merkle proof"}})]),t._v(" "),r("h3",{attrs:{id:"p2pkh-pay-to-public-key-hash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#p2pkh-pay-to-public-key-hash"}},[t._v("#")]),t._v(" P2PKH ( Pay to Public Key Hash )")]),t._v(" "),r("h4",{attrs:{id:"算法表示形式-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#算法表示形式-2"}},[t._v("#")]),t._v(" 算法表示形式")]),t._v(" "),r("p",[r("strong",[t._v("input script:")])]),t._v(" "),r("p",[t._v("PUSHDATA(Sig)")]),t._v(" "),r("p",[t._v("PUSHDATA(PubKey)")]),t._v(" "),r("p",[r("strong",[t._v("output script:")])]),t._v(" "),r("p",[t._v("DUP")]),t._v(" "),r("p",[t._v("HASH160")]),t._v(" "),r("p",[t._v("PUSHDATA(PubKeyHash)")]),t._v(" "),r("p",[t._v("EQUALVERIFY")]),t._v(" "),r("p",[t._v("CHECKSIG")]),t._v(" "),r("p",[t._v("这是最常用的指令形式。")]),t._v(" "),r("h4",{attrs:{id:"解释-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解释-2"}},[t._v("#")]),t._v(" 解释")]),t._v(" "),r("p",[t._v("这个算法与上一个算法最大的不同是，这里的 "),r("code",[t._v("output script")]),t._v(" 中给出的是公钥的 hash （ "),r("code",[t._v("PubKeyHash")]),t._v(" ）而不是直接给出公钥，公钥是在输入脚本中给出的。")]),t._v(" "),r("p",[t._v("另外，这里的主要解释上面的算法中没有提到的指令以及参数，下同。")]),t._v(" "),r("p",[r("code",[t._v("DUP")]),t._v(" ：把栈顶的元素复制一次，并放到栈顶")]),t._v(" "),r("p",[r("code",[t._v("HASH160")]),t._v(" ：把栈顶的元素取 hash ，然后把结果再压入栈")]),t._v(" "),r("p",[r("code",[t._v("PubKeyHash")]),t._v(" ：输出脚本中提供的公钥的 hash 值")]),t._v(" "),r("p",[r("code",[t._v("EQUALVERIFY")]),t._v(" ：比较栈顶的两个值是否相等")]),t._v(" "),r("h4",{attrs:{id:"实例-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实例-2"}},[t._v("#")]),t._v(" 实例")]),t._v(" "),r("p",[r("img",{attrs:{src:a(434),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("同样可以通过在 "),r("a",{attrs:{href:"https://blockstream.info",target:"_blank",rel:"noopener noreferrer"}},[t._v("Blockstream Explorer"),r("OutboundLink")],1),t._v(" 上更直观的查看结果。")]),t._v(" "),r("h3",{attrs:{id:"p2sh-pay-to-script-hash"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#p2sh-pay-to-script-hash"}},[t._v("#")]),t._v(" P2SH ( Pay to Script Hash )")]),t._v(" "),r("h4",{attrs:{id:"算法表示形式-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#算法表示形式-3"}},[t._v("#")]),t._v(" 算法表示形式")]),t._v(" "),r("p",[t._v("采用 BIP16 的方案：")]),t._v(" "),r("p",[r("strong",[t._v("input script:")])]),t._v(" "),r("p",[t._v("…")]),t._v(" "),r("p",[t._v("PUSHDATA(Sig)")]),t._v(" "),r("p",[t._v("…")]),t._v(" "),r("p",[t._v("PUSHDATA(serialized redeemScript)")]),t._v(" "),r("p",[r("strong",[t._v("output script:")])]),t._v(" "),r("p",[t._v("HASH160")]),t._v(" "),r("p",[t._v("PUSHDATA(redeemScriptHash)")]),t._v(" "),r("p",[t._v("EQUAL")]),t._v(" "),r("h4",{attrs:{id:"解释-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#解释-3"}},[t._v("#")]),t._v(" 解释")]),t._v(" "),r("p",[t._v("这里， "),r("code",[t._v("output script")]),t._v(" 提供的不是收款人公钥的 hash ，而是一段脚本的 hash （ "),r("code",[t._v("redeemScriptHash")]),t._v(" ）")]),t._v(" "),r("p",[t._v("将来花费这个 UTXO 时，需要在 "),r("code",[t._v("input script")]),t._v(" 中指定这段 "),r("code",[t._v("redeemScript")]),t._v(" 的内容，同时还需要给出让这个脚本正常执行所需要的签名（ "),r("code",[t._v("Sig")]),t._v(" ）。")]),t._v(" "),r("p",[r("code",[t._v("serialized redeemScript")]),t._v(" ：序列化后的执行脚本，在执行之前，需要先反序列化")]),t._v(" "),r("p",[r("code",[t._v("redeemScriptHash")]),t._v(" ：序列化后的执行脚本的 hash 值")]),t._v(" "),r("h4",{attrs:{id:"进一步说明"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#进一步说明"}},[t._v("#")]),t._v(" 进一步说明")]),t._v(" "),r("p",[r("code",[t._v("input script")]),t._v(" 要给出一些签名（数目不定）及一段 "),r("em",[t._v("序列化")]),t._v(" 的 "),r("strong",[t._v("redeemScript")]),t._v(" 。验证分如下两步:")]),t._v(" "),r("p",[t._v("① 验证序列化的 "),r("strong",[t._v("redeemScript")]),t._v(" 是否与 "),r("code",[t._v("output script")]),t._v(" 中的哈希值匹配?")]),t._v(" "),r("p",[t._v("② 反序列化并执行 "),r("strong",[t._v("redeemScript")]),t._v(" ,验证 "),r("code",[t._v("input script")]),t._v(" 中给出的签名是否正确?")]),t._v(" "),r("p",[r("strong",[t._v("redeemScript")]),t._v(" 的形式")]),t._v(" "),r("p",[t._v("① "),r("code",[t._v("P2PK")]),t._v(" 形式")]),t._v(" "),r("p",[t._v("② "),r("code",[t._v("P2PKH")]),t._v(" 形式")]),t._v(" "),r("p",[t._v("③ 多重签名形式")]),t._v(" "),r("h4",{attrs:{id:"实例-3"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#实例-3"}},[t._v("#")]),t._v(" 实例")]),t._v(" "),r("p",[r("img",{attrs:{src:a(435),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("上面的脚本所对应的流程如下：")]),t._v(" "),r("p",[t._v("PUSHDATA(Sig)")]),t._v(" "),r("p",[t._v("PUSHDATA(serialized redeemScript)")]),t._v(" "),r("p",[t._v("HASH160")]),t._v(" "),r("p",[t._v("PUSHDATA(redeemScriptHash)")]),t._v(" "),r("p",[t._v("EQUAL")]),t._v(" "),r("p",[t._v("PUSHDATA(PubKey)")]),t._v(" "),r("p",[t._v("CHECKSIG")]),t._v(" "),r("p",[t._v("需要注意一点，上面也提到了，这里再强调一下，在执行 "),r("code",[t._v("serialized redeemScript")]),t._v(" 之前，需要先反序列化之后再执行，这需要每个节点自动完成。")]),t._v(" "),r("h4",{attrs:{id:"多重签名"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#多重签名"}},[t._v("#")]),t._v(" 多重签名")]),t._v(" "),r("p",[t._v("在原视频的 19:50 左右，提到 "),r("code",[t._v("P2SH")]),t._v(" 在多重签名中的应用。这里对视频中老师提到的例子做一下解释。注意，这段解释需要结合原视频内容。")]),t._v(" "),r("p",[t._v("老师先举了一个不再推荐使用的多重签名的方式，这种方式没有使用到 "),r("code",[t._v("P2SH")]),t._v(" ，如下图所示，那这种方式的问题是什么呢？")]),t._v(" "),r("p",[r("img",{attrs:{src:a(436),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("最主要的问题是 "),r("code",[t._v("output script")]),t._v(" 中需要提供多个 "),r("code",[t._v("pubkey")]),t._v(" 以及 "),r("code",[t._v("M")]),t._v(" 和 "),r("code",[t._v("N")]),t._v(" 的值，这就给支付者增加了负担。")]),t._v(" "),r("p",[t._v("假设有一个购物网站有五个合伙人，他们使用多重签名的方式进行收款，并且规定，需要 3 个签名才能生效。")]),t._v(" "),r("p",[t._v("当一个用户 A 在这个网站购物时，A 作为支付者，需要拿到所有这五个合伙人的 "),r("code",[t._v("pubkey")]),t._v(" 以及 M（3）和 N （5）的值，因为支付交易是由 A 构造的。上面截图中的交易是 A 完成支付以后，五个合伙人花费 A 支付的比特币的交易， 上图中的 "),r("code",[t._v("output script")]),t._v(" 是之前 A 所创造的支付交易的输出。")]),t._v(" "),r("p",[t._v("总结来说，这么复杂的 "),r("code",[t._v("output script")]),t._v(" 需要支付者来构造，很不方便，所以就改成了 "),r("code",[t._v("P2SH")]),t._v(" 。")]),t._v(" "),r("p",[t._v("而使用 "),r("code",[t._v("P2SH")]),t._v(" 后的多重签名如下：")]),t._v(" "),r("p",[r("img",{attrs:{src:a(437),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("仍然以上面的购物网站为例，此时，支付者 A 不再需要提供 "),r("code",[t._v("pubkey")]),t._v(" 、 "),r("code",[t._v("M")]),t._v(" 和 "),r("code",[t._v("N")]),t._v(" 等信息，而只需要提供一个脚本的 hash 值即可，所有的验证操作都在 "),r("code",[t._v("redeemScript")]),t._v(" 脚本中。")]),t._v(" "),r("p",[t._v("如果还是不能理解，那就说明，对于 "),r("code",[t._v("input script")]),t._v(" 以及 "),r("code",[t._v("output script")]),t._v(" 分别属于哪个交易没有理解清楚， "),r("code",[t._v("input script")]),t._v(" 属于当前交易， "),r("code",[t._v("output script")]),t._v(" 属于币的来源的交易，也就是 "),r("code",[t._v("UTXO")]),t._v(" 。")]),t._v(" "),r("h4",{attrs:{id:"使用-p2sh-实现多重签名的实际例子"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#使用-p2sh-实现多重签名的实际例子"}},[t._v("#")]),t._v(" 使用 P2SH 实现多重签名的实际例子")]),t._v(" "),r("p",[r("img",{attrs:{src:a(438),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("交易的哈希：bc26380619a36e0ecbb5bae4eebf78d8fdef24ba5ed5fd040e7bff37311e180d")]),t._v(" "),r("h3",{attrs:{id:"proof-of-burn"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#proof-of-burn"}},[t._v("#")]),t._v(" Proof of Burn")]),t._v(" "),r("p",[r("img",{attrs:{src:a(439),alt:"Merkle proof"}})]),t._v(" "),r("p",[t._v("在输出脚本中有 "),r("code",[t._v("RETURN")]),t._v(" 命令时，脚本执行永远会返回 FALSE ， "),r("code",[t._v("RETURN")]),t._v(" 命令是证明销毁比特币的方法。")]),t._v(" "),r("p",[t._v("实际中的主要应用场景有两个：")]),t._v(" "),r("ol",[r("li",[t._v("一些小币种要求必须销毁一定的比特币才能得到相应的虚拟币")]),t._v(" "),r("li",[t._v("向区块链中写入一些不可篡改的内容")])]),t._v(" "),r("h3",{attrs:{id:"吐槽"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#吐槽"}},[t._v("#")]),t._v(" 吐槽")]),t._v(" "),r("p",[t._v("个人觉得这些脚本名字都是 "),r("code",[t._v("Pay to xxx")]),t._v(" 这种形式不太好，而改成 "),r("code",[t._v("从...收款")]),t._v(" 更好一点，因为这些脚本的含义就是验证从 "),r("code",[t._v("output script")]),t._v(" 到 "),r("code",[t._v("input script")]),t._v(" 的交易，而不是在做支付操作，使用 "),r("code",[t._v("Pay to xxx")]),t._v(" 怪怪的。")])])}),[],!1,null,null,null);s.default=e.exports}}]);